name: Emulador Android

on:
  workflow_dispatch:

jobs:
  start-emulator:
    runs-on: macos-14  # ARM-based runner

    steps:
      - name: Configurar variÃ¡veis do SDK
        run: |
          echo "ANDROID_HOME=$HOME/Library/Android/sdk" >> $GITHUB_ENV
          echo "ANDROID_SDK_ROOT=$HOME/Library/Android/sdk" >> $GITHUB_ENV
          echo "$HOME/Library/Android/sdk/platform-tools" >> $GITHUB_PATH
          echo "$HOME/Library/Android/sdk/emulator" >> $GITHUB_PATH
          echo "$HOME/Library/Android/sdk/tools" >> $GITHUB_PATH
          echo "$HOME/Library/Android/sdk/tools/bin" >> $GITHUB_PATH

      - name: Instalar system image ARM64
        run: |
          yes | sdkmanager --licenses
          sdkmanager --install "system-images;android-30;google_apis;arm64-v8a"

      - name: Criar AVD
        run: |
          echo "no" | avdmanager create avd -n test \
            -k "system-images;android-30;google_apis;arm64-v8a" \
            --device "pixel"

      - name: Iniciar emulador (modo software)
        run: |
          $ANDROID_HOME/emulator/emulator -avd test \
            -no-audio -no-window -gpu swiftshader_indirect \
            -no-snapshot -no-boot-anim -verbose \
            -qemu -accel tcg &
          adb wait-for-device
          adb shell input keyevent 82



      - name: Tirar screenshot
        run: adb exec-out screencap -p > screenshot.png

      - name: Upload screenshot
        uses: actions/upload-artifact@v4
        with:
          name: emulator-screenshot
          path: screenshot.png

      - name: Keep Alive
        run: |
          echo "Emulador rodando por 5 minutos..."
          sleep 300
