name: Start Android Emulator

on:
  push:
    branches: [main]

jobs:
  start-emulator:
    runs-on: macos-latest

    steps:
      - name: Set up Android SDK
        uses: android-actions/setup-android@v3

      - name: Install system image
      run: |
        yes | sdkmanager --install "system-images;android-30;google_apis;arm64-v8a"
        sdkmanager --licenses

      - name: Create AVD
        run: |
          echo "no" | avdmanager create avd -n test -k "system-images;android-30;google_apis;arm64-v8a" --device "pixel"

      - name: Start Emulator
        run: |
          $ANDROID_HOME/emulator/emulator -avd test -no-audio -no-window -gpu swiftshader_indirect &
          adb wait-for-device
          adb shell input keyevent 82

      - name: Tirar screenshot
        run: adb exec-out screencap -p > screenshot.png

      - name: Upload screenshot
        uses: actions/upload-artifact@v4
        with:
          name: emulator-screenshot
          path: screenshot.png

      - name: Keep Alive
        run: |
          echo "Emulador rodando por 5 minutos..."
          sleep 300
